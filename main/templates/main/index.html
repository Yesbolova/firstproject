{% load static %}
<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Python Оқу Платформасы{% endblock %}</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- Prism -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material.min.css">

<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material.min.css">

<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>

  <style>
  <style>
  .content {
    max-width: 900px;
    margin: 0 auto;
    padding: 32px 24px 40px;
  }

  .compiler-wrapper {
    background: #ffffff;
    border-radius: 24px;
    box-shadow: 0 20px 50px rgba(15, 23, 42, 0.08);
    padding: 24px 22px 26px;
  }

  .compiler-header {
    text-align: center;
    margin-bottom: 18px;
  }

  .compiler-header h1 {
    margin: 0 0 6px;
    font-size: 30px;
  }

  .compiler-header p {
    margin: 0;
    font-size: 14px;
    color: #6b7280;
  }

  .compiler-section {
    margin-top: 14px;
  }

  .compiler-label {
    font-size: 14px;
    font-weight: 500;
    margin: 0 0 6px;
  }

  /* CodeMirror */
  #pyCode {
    min-height: 220px;
  }

  .code-editor .CodeMirror {
    height: 260px;
    border-radius: 16px;
    border: 1px solid #e5e7eb;
    background: #0f172a;
    font-size: 14px;
  }

  .cm-s-material.CodeMirror {
    background: #0f172a;
    color: #e5e7eb;
  }

  .cm-s-material .CodeMirror-gutters {
    background: #020617;
    border-right: 1px solid #1f2937;
  }

  .cm-s-material .CodeMirror-linenumber {
    color: #6b7280;
  }

  /* Консоль */
  #pyConsole {
    width: 100%;
    min-height: 220px;
    font-family: "JetBrains Mono","Consolas","Courier New",monospace;
    font-size: 13px;
    border-radius: 16px;
    border: none;
    padding: 12px 14px;
    box-sizing: border-box;
    background: #020617;
    color: #e5e7eb;
    resize: vertical;
    white-space: pre-wrap;
    overflow-x: auto;
  }

  .compiler-buttons {
    margin-top: 10px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .compiler-buttons button {
    padding: 8px 18px;
    border-radius: 999px;
    border: 1px solid #e5e7eb;
    background: #f9fafb;
    font-size: 14px;
    cursor: pointer;
    transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
  }

  .compiler-buttons button:first-child {
    background: #2563eb;
    color: #ffffff;
    border-color: #2563eb;
    box-shadow: 0 10px 26px rgba(37, 99, 235, 0.35);
  }

  .compiler-buttons button:hover {
    transform: translateY(-1px);
    box-shadow: 0 10px 24px rgba(15, 23, 42, 0.12);
  }

  @media (max-width: 640px) {
    .content {
      padding: 20px 14px 32px;
    }

    .compiler-wrapper {
      padding: 18px 14px 20px;
    }

    .compiler-header h1 {
      font-size: 24px;
    }
  }


@media (max-width: 640px) {
  .content {
    padding: 20px 14px 32px;
  }

  .compiler-wrapper {
    padding: 18px 14px 20px;
  }

  .compiler-header h1 {
    font-size: 24px;
  }
}

    :root{
      --bg:#ffffff;
      --sidebar-bg:#f6f6f6;
      --text:#1d1d1f;
      --text-light:#6b7280;
      --green:#34C759;
      --green-soft: rgba(52,199,89,0.16);
      --blue:#0071e3;
      --border:#e5e5e5;
      --radius:18px;
      --shadow:0 8px 28px rgba(0,0,0,0.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      font-family:"Inter",sans-serif;
      color:var(--text);
    }

    /* NAVBAR */
    .navbar{
      background:#ffffffd8;
      backdrop-filter: blur(12px);
      border-bottom:1px solid var(--border);
      position:sticky; top:0; z-index:50;
    }
    .nav-container{
      width:94%; margin:0 auto; padding:14px 0;
      display:flex; justify-content:space-between; align-items:center;
    }
    .nav-title{font-size:20px;font-weight:600}
    .nav-right a{
      padding:8px 14px; border-radius:10px;
      border:1px solid var(--blue); color:var(--blue);
      text-decoration:none; margin-left:8px;
      font-size:14px; font-weight:500;
    }

    /* LAYOUT */
    .layout{display:flex;gap:0}

    /* SIDEBAR */
    .sidebar{
      width:270px; background:var(--sidebar-bg);
      padding:18px; height:calc(100vh - 62px);
      position:sticky; top:62px; overflow-y:auto;
      border-right:1px solid var(--border);
    }

    .accordion{
      background:transparent; cursor:pointer; width:100%;
      padding:12px 10px; text-align:left;
      border:none; outline:none; font-size:16px;
      color:var(--text); font-weight:600;
      border-radius:10px; transition:.2s;
      margin-top:6px;
    }
    .accordion:hover{background:#e9e9e9}
    .accordion.active{
      background:#eafff1; color:#0b6b2b;
    }

    .panel{display:none; padding:6px 0 6px 10px;}
    .panel.show{display:block}

    .panel a{
      display:block; padding:8px 8px;
      text-decoration:none; color:#333;
      border-radius:8px; font-size:15px;
      margin:2px 0; transition:.2s;
    }
    .panel a:hover{
      background:var(--green-soft); color:#0b6b2b; font-weight:500;
    }
    .panel a.active{
      background:var(--green-soft);
      color:#0b6b2b; font-weight:700;
      border-left:4px solid var(--green);
    }

    /* CONTENT */
    .content{
      flex-grow:1; padding:26px 48px;
      min-height:calc(100vh - 62px);
    }

    /* HERO only for main */
    .hero-block{width:100%;display:flex;justify-content:center;margin:10px 0 40px;}
    .glass-card{
      width:80%; padding:36px; border-radius:28px;
      background:rgba(255,255,255,0.72); backdrop-filter:blur(18px);
      box-shadow:var(--shadow); text-align:center;
    }
    .python-3d{
      width:100px; margin-bottom:18px;
      filter:drop-shadow(0 6px 12px rgba(0,0,0,0.25));
    }
    .glass-card h2{font-size:34px;font-weight:600;margin:0 0 8px}
    .glass-card p{font-size:17px;color:var(--text-light);margin:0}
    .hero-buttons{margin-top:22px;display:flex;justify-content:center;gap:12px;}
    .hero-btn{
      padding:11px 24px; border-radius:14px;
      text-decoration:none; font-size:15px; font-weight:600; transition:.2s;
    }
    .hero-btn.primary{background:var(--blue);color:white}
    .hero-btn.primary:hover{background:#005bbf}
    .hero-btn.secondary{background:#e5e5e7;color:#111}
    .hero-btn.secondary:hover{background:#d0d0d4}

    /* GAMIFICATION */
    .progress-card{
      background:#fff; border-radius:22px;
      padding:18px 20px; box-shadow:var(--shadow);
      margin:0 0 22px;
    }
    .progress-head{
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom:10px;
    }
    .progress-title{font-size:18px;font-weight:700}
    .xp-pill{
      background:#eef6ff; color:#0b5bd3;
      padding:6px 12px; border-radius:999px;
      font-weight:700; font-size:14px; border:1px solid #d6e6ff;
    }
    .bar{
      width:100%; height:10px; background:#e5e7eb;
      border-radius:999px; overflow:hidden;
    }
    .bar-fill{
      height:100%; width:0%; background:var(--green); transition:.3s;
    }
    .progress-meta{margin-top:8px;font-size:14px;color:#4b5563;}

    /* DONE BUTTONS */
    .btn-done{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:12px;
      border:1px solid #e5e7eb; background:#fafafa;
      cursor:pointer; font-weight:700; font-size:14px;
      transition:.2s; user-select:none;
    }
    .btn-done.done{
      background:#eafff1; border-color:#bde9c7; color:#0b6b2b;
    }

    .footer{text-align:center;margin:30px 0;color:#999;font-size:14px;}
  </style>
</head>

<body>

<nav class="navbar">
  <div class="nav-container">
    <span class="nav-title">Python тілінде программалау</span>
    <div class="nav-right">
      <a href="/signup">Регистрация</a>
      <a href="{% url 'login' %}">Кіру</a>
    </div>
  </div>
</nav>

<div class="layout">
{% with p=request.path %}

  <!-- SIDEBAR -->
  <aside class="sidebar">

    <!-- 6-сынып -->
    <button class="accordion {% if '/praktika' in p or '/syntax' in p or '/datatype' in p or '/arithmeticoperation' in p or '/inputandoutput' in p or '/linearalgortm' in p %}active{% endif %}">
      6-сынып
    </button>
    <div class="panel {% if '/praktika' in p or '/syntax' in p or '/datatype' in p or '/arithmeticoperation' in p or '/inputandoutput' in p or '/linearalgortm' in p %}show{% endif %}">
      <a href="/praktika" class="{% if p == '/praktika' or p == '/praktika/' %}active{% endif %}">IDE – мен танысу</a>
      <a href="/syntax" class="{% if p == '/syntax' or p == '/syntax/' %}active{% endif %}">Тіл әліппесі</a>
      <a href="/datatype" class="{% if p == '/datatype' or p == '/datatype/' %}active{% endif %}">Мәліметтер типтері</a>
      <a href="/arithmeticoperation" class="{% if p == '/arithmeticoperation' or p == '/arithmeticoperation/' %}active{% endif %}">Арифметикалық амалдар</a>
      <a href="/inputandoutput" class="{% if p == '/inputandoutput' or p == '/inputandoutput/' %}active{% endif %}">Енгізу және шығару</a>
      <a href="/linearalgortm" class="{% if p == '/linearalgortm' or p == '/linearalgortm/' %}active{% endif %}">Сызықтық алгоритмдер</a>
    </div>

    <!-- 7-сынып -->
    <button class="accordion {% if '/workingwithfiles' in p or '/programmingalgorithms' in p %}active{% endif %}">
      7-сынып
    </button>
    <div class="panel {% if '/workingwithfiles' in p or '/programmingalgorithms' in p %}show{% endif %}">
      <a href="/workingwithfiles" class="{% if p == '/workingwithfiles' or p == '/workingwithfiles/' %}active{% endif %}">Файлдармен жұмыс</a>
      <a href="/programmingalgorithms01" class="{% if p == '/programmingalgorithms01' or p == '/programmingalgorithms01/' %}active{% endif %}">Тармақталған алгоритмдер</a>
      <a href="/programmingalgorithms02" class="{% if p == '/programmingalgorithms02' or p == '/programmingalgorithms02/' %}active{% endif %}">Кірістірілген шарттар</a>
      <a href="/programmingalgorithms03" class="{% if p == '/programmingalgorithms03' or p == '/programmingalgorithms03/' %}active{% endif %}">Күрделі шарттар</a>
      <a href="/programmingalgorithms04" class="{% if p == '/programmingalgorithms04' or p == '/programmingalgorithms04/' %}active{% endif %}">Таңдау операторлары</a>
    </div>

    <!-- 8-сынып -->
    <button class="accordion {% if '/operator' in p or '/trassirovka' in p %}active{% endif %}">
      8-сынып
    </button>
    <div class="panel {% if '/operator' in p or '/trassirovka' in p %}show{% endif %}">
      <a href="/operator01" class="{% if p == '/operator01' or p == '/operator01/' %}active{% endif %}">While циклі</a>
      <a href="/operator02" class="{% if p == '/operator02' or p == '/operator02/' %}active{% endif %}">For циклі</a>
      <a href="/operator03" class="{% if p == '/operator03' or p == '/operator03/' %}active{% endif %}">Continue</a>
      <a href="/operator04" class="{% if p == '/operator04' or p == '/operator04/' %}active{% endif %}">Break</a>
      <a href="/operator05" class="{% if p == '/operator05' or p == '/operator05/' %}active{% endif %}">Else</a>
      <a href="/trassirovka" class="{% if p == '/trassirovka' or p == '/trassirovka/' %}active{% endif %}">Алгоритм трассировкасы</a>
    </div>

    <!-- 9-сынып -->
    <button class="accordion {% if '/birolshemdimassiv' in p or '/orynauystyru' in p or '/ekiolshemdimassiv' in p or '/suryptau' in p or '/zhoyujanekiristiru' in p or '/pygame' in p %}active{% endif %}">
      9-сынып
    </button>
    <div class="panel {% if '/birolshemdimassiv' in p or '/orynauystyru' in p or '/ekiolshemdimassiv' in p or '/suryptau' in p or '/zhoyujanekiristiru' in p or '/pygame' in p %}show{% endif %}">
      <a href="/birolshemdimassiv" class="{% if p == '/birolshemdimassiv' or p == '/birolshemdimassiv/' %}active{% endif %}">Бір өлшемді массив</a>
      <a href="/orynauystyru" class="{% if p == '/orynauystyru' or p == '/orynauystyru/' %}active{% endif %}">Элементтерді ауыстыру</a>
      <a href="/ekiolshemdimassiv" class="{% if p == '/ekiolshemdimassiv' or p == '/ekiolshemdimassiv/' %}active{% endif %}">Екі өлшемді массив</a>
      <a href="/suryptau" class="{% if p == '/suryptau' or p == '/suryptau/' %}active{% endif %}">Сұрыптау</a>
      <a href="/zhoyujanekiristiru" class="{% if p == '/zhoyujanekiristiru' or p == '/zhoyujanekiristiru/' %}active{% endif %}">Жою және кірістіру</a>
      <a href="/pygame" class="{% if p == '/pygame' or p == '/pygame/' %}active{% endif %}">Pygame</a>
    </div>

    <!-- 10-сынып -->
    <button class="accordion {% if '/string' in p %}active{% endif %}">
      10-сынып
    </button>
    <div class="panel {% if '/string' in p %}show{% endif %}">
      <a href="/string" class="{% if p == '/string' or p == '/string/' %}active{% endif %}">Жолдық әдістер</a>
    </div>

  </aside>

  <!-- CONTENT -->
  <main class="content">


 {% block content %}
<main class="content">


  <section class="compiler-wrapper">
    <div class="compiler-header">
      <img src="https://upload.wikimedia.org/wikipedia/commons/c/c3/Python-logo-notext.svg"
             alt="Python Logo" class="python-3d">
        <h2>Python үйренудің жаңа деңгейі</h2>
        <p>Интерактивті оқу платформасы.</p>

    </div>

    <!-- Код (жоғарыда) -->
    <section class="compiler-section">
      <p class="compiler-label">Код:</p>
      <textarea id="pyCode" spellcheck="false">
n = int(input("n санын енгізіңіз: "))

i = 1
while i <= n:
    if i % 2 == 0:
        print(i)
    i = i + 1
      </textarea>
    </section>

    <!-- Батырмалар -->
    <div class="compiler-buttons">
      <button type="button" id="runBtn">Run ▶</button>
      <button type="button" id="clearBtn">Терезені тазалау</button>
    </div>

    <!-- Нәтиже (төменде, input+output) -->
    <section class="compiler-section">
      <p class="compiler-label">Нәтиже (input/output):</p>
      <textarea id="pyConsole" spellcheck="false"
                placeholder="Run басыңыз. input() шақырылғанда мұнда prompt шығады.
Сан жазып, Enter басасыз."></textarea>
    </section>
  </section>
</main>
    <script>
  let editor = null;
  let waitingForInput = false;
  let pendingInputResolve = null;

  function builtinRead(x) {
    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined) {
      throw "File not found: '" + x + "'";
    }
    return Sk.builtinFiles["files"][x];
  }

  function outf(text) {
    const con = document.getElementById("pyConsole");
    con.value += text;
    con.scrollTop = con.scrollHeight;
  }

  function clearPythonOutput() {
    const con = document.getElementById("pyConsole");
    con.value = "";
    waitingForInput = false;
    pendingInputResolve = null;
  }

  function runPythonCode() {
    const con = document.getElementById("pyConsole");
    clearPythonOutput();

    const code = editor
      ? editor.getValue()
      : document.getElementById("pyCode").value;

    Sk.configure({
      output: outf,
      read: builtinRead,

      inputfun: function (promptText) {
        let promptStr = "";
        if (typeof promptText === "string") {
          promptStr = promptText;
        } else if (window.Sk && Sk.ffi && typeof Sk.ffi.remapToJs === "function") {
          promptStr = Sk.ffi.remapToJs(promptText) || "";
        }

        if (promptStr) {
          con.value += promptStr + " ";
          con.scrollTop = con.scrollHeight;
        }

        return new Promise(function (resolve) {
          waitingForInput = true;
          pendingInputResolve = resolve;
        });
      },

      inputfunTakesPrompt: true
    });

    const promise = Sk.misceval.asyncToPromise(function () {
      return Sk.importMainWithBody("<stdin>", false, code, true);
    });

    promise.then(
      function () {
        // success
      },
      function (err) {
        con.value += "\n[Қате] " + err.toString();
        con.scrollTop = con.scrollHeight;
        waitingForInput = false;
        pendingInputResolve = null;
        console.error(err);
      }
    );
  }

  document.addEventListener("DOMContentLoaded", function () {
    const codeTextarea = document.getElementById("pyCode");
    const consoleEl = document.getElementById("pyConsole");

    editor = CodeMirror.fromTextArea(codeTextarea, {
      mode: "python",
      theme: "material",
      lineNumbers: true,
      indentUnit: 4,
      tabSize: 4,
      autofocus: true,
    });

    const cmWrapper = editor.getWrapperElement();
    const parent = codeTextarea.parentElement;
    parent.classList.add("code-editor");
    parent.insertBefore(cmWrapper, codeTextarea);
    codeTextarea.style.display = "none";

    document.getElementById("runBtn").addEventListener("click", runPythonCode);
    document.getElementById("clearBtn").addEventListener("click", clearPythonOutput);

 consoleEl.addEventListener("keydown", function (e) {
  if (waitingForInput && e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();

    const text = consoleEl.value;
    const lines = text.split(/\r?\n/);
    const lastLine = lines[lines.length - 1];

    // Соңғы жолдан енгізілген мәнді бөліп аламыз
    let value = lastLine;
    const idx = value.lastIndexOf(":");
    if (idx !== -1) {
      // "n санын енгізіңіз:  6" → " 6"
      value = value.slice(idx + 1);
    }
    value = value.trim();  // " 6" → "6"

    consoleEl.value += "\n";
    consoleEl.scrollTop = consoleEl.scrollHeight;

    if (pendingInputResolve) {
      const resolve = pendingInputResolve;
      pendingInputResolve = null;
      waitingForInput = false;
      resolve(value);      // input() енді тек "6" алады
    }
  }
});

  });
</script>
{% endblock %}


  </main>
{% endwith %}
</div>

<footer class="footer">
  © 2025 Python оқу платформасы. Apple Light Edition.
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

<script>
/* 1) ACCORDION */
document.querySelectorAll(".accordion").forEach((btn) => {
  btn.addEventListener("click", () => {
    const panel = btn.nextElementSibling;
    btn.classList.toggle("active");
    panel.classList.toggle("show");
  });
});

/* 2) GAMIFICATION XP */
(function(){
  const pathKey = "xp:" + window.location.pathname;
  const doneKey = "done:" + window.location.pathname;

  let xp = parseInt(localStorage.getItem(pathKey) || "0");
  let doneMap = JSON.parse(localStorage.getItem(doneKey) || "{}");

  const buttons = document.querySelectorAll(".btn-done");
  const xpValue = document.getElementById("xpValue");
  const barFill = document.getElementById("barFill");
  const doneCountEl = document.getElementById("doneCount");
  const totalCountEl = document.getElementById("totalCount");

  totalCountEl.textContent = buttons.length;

  function render(){
    xpValue.textContent = xp;

    let doneCount = 0;
    buttons.forEach(btn => {
      const block = btn.dataset.block;
      const isDone = !!doneMap[block];
      btn.classList.toggle("done", isDone);
      btn.innerHTML = isDone ? "✅ Орындалды" : "⬜ Орындалды";
      if(isDone) doneCount++;
    });

    doneCountEl.textContent = doneCount;

    const total = buttons.length;
    const pct = total ? Math.round((doneCount / total) * 100) : 0;
    barFill.style.width = pct + "%";
  }

  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      const block = btn.dataset.block;
      const addXp = parseInt(btn.dataset.xp || "0");
      if(doneMap[block]) return;

      doneMap[block] = true;
      xp += addXp;

      localStorage.setItem(pathKey, xp);
      localStorage.setItem(doneKey, JSON.stringify(doneMap));
      render();
    });
  });

  render();
})();
</script>



</body>
</html>
